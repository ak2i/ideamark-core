{
  "version": "1",
  "validate": {
    "schema": "ideamark.schema.yaml",
    "failOnWarning": true
  },
  "inputs": [
    "design/entitlement-core.designdoc.yaml",
    "design/storycraft.designdoc.yaml"
  ],
  "targets": {
    "typescript": {
      "outDir": "generated/ts",
      "arrayStyle": "T[]",
      "nullableStyle": "tsUnion",
      "enumPolicy": "inlineUnion",
      "header": "/* @generated by ideamark-gen */",
      "fileNameCase": "kebab",
      "interfaceSuffix": ""
    },
    "jsonSchema": {
      "outDir": "generated/schema",
      "defsPerEntity": true,
      "additionalPropertiesDefault": true
    },
    "adr": {
      "outDir": "generated/adr",
      "template": "templates/adr-0001.md"
    },
    "openapi": {
      "enabled": true,
      "outFile": "generated/openapi.yaml",
      "basePath": "/api",
      "groupBy": "domain.subdomain",
      "security": [
        {
          "bearerAuth": {
            "type": "http",
            "scheme": "bearer"
          }
        }
      ],
      "problemSchemaRef": "ProblemDetails"
    }
  },
  "typeMappings": {
    "Id": {
      "ts": "Id",
      "json": {
        "type": "string"
      }
    },
    "timestamp": {
      "ts": "string",
      "json": {
        "type": "string",
        "format": "date-time"
      }
    },
    "timestamp|null": {
      "ts": "string | null",
      "json": {
        "type": [
          "string",
          "null"
        ],
        "format": "date-time"
      }
    },
    "map<string, any>": {
      "ts": "Record<string, unknown>",
      "json": {
        "type": "object",
        "additionalProperties": true
      }
    }
  },
  "naming": {
    "prefixNamespace": false,
    "emitNamespaceComments": true
  },
  "enumRefPolicy": "inline",
  "routes": {
    "entitlement": {
      "Grant": {
        "method": "POST",
        "path": "/entitlements",
        "idempotencyKey": "idempotencyKey"
      },
      "Revoke": {
        "method": "DELETE",
        "path": "/entitlements/{subjectId}/{relation}/{resourceId}"
      },
      "ListUserEntitlements": {
        "method": "GET",
        "path": "/entitlements/{subjectId}",
        "query": [
          "relation",
          "kindFilter",
          "page",
          "pageSize"
        ]
      },
      "ListEntitledUsers": {
        "method": "GET",
        "path": "/entitlements/by-resource/{resourceId}/{relation}",
        "query": [
          "page",
          "pageSize"
        ]
      }
    },
    "storycraft": {
      "SelectStoryTemplate": {
        "method": "POST",
        "path": "/storycraft/templates:select"
      },
      "RenderStory": {
        "method": "POST",
        "path": "/storycraft/stories:render"
      },
      "GenerateOutputUnit": {
        "method": "POST",
        "path": "/storycraft/outputs:generate"
      },
      "PublishOutputUnit": {
        "method": "POST",
        "path": "/storycraft/outputs/{outputId}:publish"
      },
      "Notify": {
        "method": "POST",
        "path": "/storycraft/outputs/{outputId}:notify"
      },
      "ListStoryTemplatesByTags": {
        "method": "GET",
        "path": "/storycraft/templates",
        "query": [
          "tags"
        ]
      },
      "GetOutput": {
        "method": "GET",
        "path": "/storycraft/outputs/{outputId}"
      },
      "ListOutputsByBundle": {
        "method": "GET",
        "path": "/storycraft/bundles/{bundleId}/outputs"
      }
    }
  },
  "overrides": {
    "entitlement": {
      "typescript": {
        "fileName": "entitlement.types.ts"
      },
      "jsonSchema": {
        "fileName": "entitlement.schema.json"
      },
      "adr": {
        "fileName": "entitlement.ADR-0001.md"
      }
    },
    "storycraft": {
      "typescript": {
        "fileName": "storycraft.types.ts"
      },
      "jsonSchema": {
        "fileName": "storycraft.schema.json"
      },
      "adr": {
        "fileName": "storycraft.ADR-0001.md"
      }
    }
  },
  "postProcess": {
    "prettier": true,
    "eslintFix": true
  }
}